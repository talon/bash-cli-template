#!/bin/bash
VIRO_HOME="${VIRO_HOME:-"$( cd "$( dirname "${BASH_SOURCE[0]}" )" 2>&1 && cd ../ 2>&1 && pwd)"}"

source "$VIRO_HOME/src/log.sh"

# Flags
# NOTE: if a flag takes an argument you need to `shift 2`, otherwise just `shift`
# =====================================================================================================================

PARAMS=""
while (( "$#" )); do case "$1" in
  --)
    shift
    break
    ;;
  -*|--*)
    log "Error: Unsupported flag $1" >&2
    exit 1
    ;;
  *)
    PARAMS="$PARAMS $1"
    shift
    ;;
esac; done
eval set -- "$PARAMS"

case "$1" in
  r|rm|remove) rm -rf "$VIRO_HOME/bins/$2";;
  ls|show|view) ls "$VIRO_HOME/bins";;
  rename) mv "$VIRO_HOME/bins/$2" "$VIRO_HOME/bins/$3";;
  a|add|edit|create)
    if [ -z "$1" ]; then
      "$VISUAL" "$VIRO_HOME/bins/"
    else
      [ -x "$VIRO_HOME/bins/$2" ] || {
        cp "$VIRO_HOME/templates/bin" "$VIRO_HOME/bins/$2"
        chmod +x "$VIRO_HOME/bins/$2"
      }
      "$VISUAL" "$VIRO_HOME/bins/$2"
    fi
    ;;
  *) man -l "$VIRO_HOME/.manpages/bin.1"
esac
