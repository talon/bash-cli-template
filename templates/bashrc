BIN_HOME="/c/Users/tpoole/Documents/GitHub/bin"
[[ -f "$BIN_HOME/user/ENV" ]] && source "$BIN_HOME/user/ENV";
[[ -f "$BIN_HOME/user/secret_ENV" ]] && source "$BIN_HOME/user/secret_ENV";
[[ -f "$BIN_HOME/user/aliases" ]] && source "$BIN_HOME/user/aliases";

source "$BIN_HOME/src/host/wsl-ubuntu.sh"
source "$BIN_HOME/src/log.sh"

packages() {
  log "ensuring packages are available"
  nvim -v | grep -q -E "NVIM v0.3.*" || {
    log "adding neovim repo and upgrading"
    repo ppa:neovim-ppa/stable;
    sudo apt update;
    sudo apt upgrade -y;
    ensure neovim;
  }
  ensure python-dev;
  ensure python-pip;
  ensure python3-dev;
  ensure python3-pip;
  ensure python-neovim;
  ensure python3-neovim;
  ensure tmux
  ensure tig
  is_installed docker-ce || {
    log "adding docker-ce repo and installing"
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -;
    sudo apt-key fingerprint 0EBFCD88;
    repo "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable";
    ensure docker-ce;
    sudo usermod -aG docker "$USER";
  }
  ensure docker-compose
  ensure gettext
}

[[ -s "$NVM_DIR/nvm.sh" ]] && \. "$NVM_DIR/nvm.sh"
[[ -n "$PS1" ]] && [[ -s "$BASE16_SHELL/profile_helper.sh" ]] && eval "$("$BASE16_SHELL/profile_helper.sh")";
[[ -f "$HOME/.fzf.bash" ]] && source "$HOME/.fzf.bash";
[[ -z "$TMUX"  ]] && {
  ssh-keygen -q -N "" < /dev/zero > /dev/null
  packages
  clone https://github.com/chriskempson/base16-shell.git "$BASE16_SHELL"
  download "https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim" "$HOME/.local/share/nvim/site/autoload/plug.vim"
  template "$BIN_HOME/templates/init.vim" "$HOME/.config/nvim/init.vim"
  clone https://github.com/tmux-plugins/tpm "$HOME/.tmux/plugins/tpm"
  template "$BIN_HOME/templates/tmux.conf" "$HOME/.tmux.conf"
  clone https://github.com/nvm-sh/nvm.git "$NVM_DIR"
  tmux attach || exec tmux new-session
}
